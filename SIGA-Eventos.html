<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGA-Eventos - Protótipo Interativo</title>
    <!-- Chosen Palette: Corporate Calm -->
    <!-- Application Structure Plan: A Single-Page Application (SPA) with multiple distinct views (Login, User-Calendar, User-Bookings, Admin-Dashboard, Admin-Rooms). Visibility is controlled via JavaScript, toggling a 'hidden' class. This structure was chosen because it cleanly separates the functionalities for different user roles and tasks within a single, seamless experience without page reloads. The user flow logically progresses from authentication to the relevant functional panel. -->
    <!-- Visualization & Content Choices: 
        1. Admin KPIs -> Goal: Inform -> Styled HTML/Tailwind Cards -> No major interaction -> Provides immediate, scannable key metrics.
        2. Room Utilization -> Goal: Compare -> Chart.js Horizontal Bar Chart (Canvas) -> Interaction: Hover tooltips, time-period filter buttons -> Best method for comparing performance across distinct categories (rooms), providing clear visual hierarchy and user-controlled data granularity. Adheres to NO SVG rule.
        3. Event Calendar -> Goal: Organize/Inform -> Dynamic HTML/Tailwind CSS Grid generated by JS -> Interaction: Click on free slots or button opens a modal; Month/Year filters update the view -> An intuitive, industry-standard interface for viewing availability.
        4. User Bookings/Manage Rooms -> Goal: Organize/Inform -> Dynamic HTML Tables -> Interaction: Buttons for actions (add, edit, toggle status) -> Standard and effective way to display and manage list-based data.
        5. Scheduling/Room Form -> Goal: Organize -> HTML Modal -> Interaction: Form submission -> A standard, non-disruptive way to handle data input. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://rsms.me/inter/inter.css');
        body { font-family: 'Inter', sans-serif; }
        .chart-container { position: relative; width: 100%; max-width: 48rem; margin-left: auto; margin-right: auto; height: 24rem; }
        .calendar-grid { grid-template-columns: 80px repeat(7, 1fr); }
        .nav-link-active { color: #2563eb; border-bottom-width: 2px; border-color: #2563eb; font-weight: 600; }
        .filter-btn-active { background-color: #3b82f6; color: white; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <!-- Tela de Login -->
    <div id="loginView" class="min-h-screen flex items-center justify-center p-4 transition-opacity duration-500">
        <div class="w-full max-w-md bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-slate-800">SIGA-Eventos</h1>
                <p class="text-slate-500 mt-2">Sistema Integrado de Gestão de Agendamentos</p>
            </div>
            <form id="loginForm">
                <div class="mb-4">
                    <label for="email" class="block text-sm font-medium text-slate-600 mb-1">Email</label>
                    <input type="email" id="email" class="w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="email@gmail.com" required>
                </div>
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-slate-600 mb-1">Senha</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="*******" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-2.5 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-300 transform hover:scale-105">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Tela Principal do Usuário -->
    <div id="userView" class="hidden min-h-screen bg-slate-100 transition-opacity duration-500">
        <header class="bg-white shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-slate-800">SIGA-Eventos</h1>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#" id="nav-calendar" class="nav-link text-slate-600 hover:text-blue-600 font-medium pb-1">Início</a>
                    <a href="#" id="nav-my-bookings" class="nav-link text-slate-600 hover:text-blue-600 font-medium pb-1">Meus Agendamentos</a>
                </nav>
                <div class="flex items-center space-x-3">
                     <span id="userName" class="font-semibold text-slate-700 hidden md:block"></span>
                     <button class="logout-btn text-sm font-medium text-red-500 hover:text-red-700">(Sair)</button>
                </div>
            </div>
        </header>
        <main class="container mx-auto p-6">
            <!-- Conteúdo do Painel de Agendamento -->
            <div id="calendar-view-content">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <h2 class="text-3xl font-bold text-slate-800 mb-4 md:mb-0">Painel de Agendamento</h2>
                    <button id="openModalBtn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-all duration-300 shadow hover:shadow-lg">Agendar Evento</button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                     <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-4">
                        <div id="month-year-display" class="text-xl font-semibold mb-3 md:mb-0"></div>
                         <div class="flex items-center space-x-2">
                            <label for="month-filter" class="text-sm font-medium">Mês:</label>
                            <select id="month-filter" class="border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500"></select>
                            <label for="year-filter" class="text-sm font-medium">Ano:</label>
                            <select id="year-filter" class="border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500"></select>
                            <label for="roomFilter" class="text-sm font-medium">Sala:</label>
                            <select id="roomFilter" class="border border-slate-300 rounded-lg p-2 text-sm focus:ring-2 focus:ring-blue-500">
                                <option>Todas as Salas</option>
                                <option>Sala 1</option>
                                <option>Sala 2</option>
                                <option>Auditório</option>
                            </select>
                         </div>
                    </div>
                    <div id="calendar-grid-container" class="overflow-x-auto"></div>
                </div>
            </div>
            <!-- Conteúdo de Meus Agendamentos -->
            <div id="my-bookings-view-content" class="hidden">
                 <h2 class="text-3xl font-bold text-slate-800 mb-6">Meus Agendamentos</h2>
                 <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th class="px-6 py-3">Título do Evento</th>
                                    <th class="px-6 py-3">Sala</th>
                                    <th class="px-6 py-3">Data</th>
                                    <th class="px-6 py-3">Horário</th>
                                    <th class="px-6 py-3">Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium">Reunião de Alinhamento Semanal</td>
                                    <td class="px-6 py-4">Sala 1</td>
                                    <td class="px-6 py-4">10/10/2025</td>
                                    <td class="px-6 py-4">14:00 - 15:00</td>
                                    <td class="px-6 py-4"><button class="font-medium text-red-600 hover:underline">Cancelar</button></td>
                                </tr>
                                <tr class="bg-white border-b">
                                    <td class="px-6 py-4 font-medium">Apresentação de Projeto</td>
                                    <td class="px-6 py-4">Auditório</td>
                                    <td class="px-6 py-4">15/10/2025</td>
                                    <td class="px-6 py-4">10:00 - 11:30</td>
                                    <td class="px-6 py-4"><button class="font-medium text-red-600 hover:underline">Cancelar</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </main>
    </div>

    <!-- Painel do Administrador -->
    <div id="adminView" class="hidden min-h-screen bg-slate-100 transition-opacity duration-500">
        <header class="bg-white shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-slate-800">SIGA-Eventos (Admin)</h1>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#" id="nav-dashboard" class="nav-link pb-1">Histórico das salas</a>
                    <a href="#" id="nav-manage-rooms" class="nav-link pb-1">Gerenciar Salas</a>
                </nav>
                 <div class="flex items-center space-x-3">
                     <span class="font-semibold text-slate-700 hidden md:block">Admin</span>
                     <button class="logout-btn text-sm font-medium text-red-500 hover:text-red-700">(Sair)</button>
                </div>
            </div>
        </header>
        <main class="container mx-auto p-6">
            <!-- Conteúdo do Dashboard -->
            <div id="dashboard-view-content">
                <h2 class="text-3xl font-bold text-slate-800 mb-6">Controle de utilização</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-lg font-medium text-slate-500">Total de Salas</h3>
                        <p id="total-rooms-kpi" class="text-5xl font-bold text-blue-600 mt-2">3</p>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-lg font-medium text-slate-500">Eventos Hoje</h3>
                        <p class="text-5xl font-bold text-blue-600 mt-2">12</p>
                    </div>
                     <div class="bg-white p-6 rounded-xl shadow-lg text-center">
                        <h3 class="text-lg font-medium text-slate-500">Taxa de Ocupação</h3>
                        <p class="text-5xl font-bold text-blue-600 mt-2">67%</p>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4">
                        <h3 class="text-xl font-semibold text-slate-800 mb-3 md:mb-0">Utilização por Sala</h3>
                        <div id="chart-filters" class="flex items-center space-x-2 bg-slate-100 p-1 rounded-lg">
                            <button data-period="day" class="chart-filter-btn px-3 py-1 text-sm font-medium rounded-md transition-colors">Dia</button>
                            <button data-period="week" class="chart-filter-btn px-3 py-1 text-sm font-medium rounded-md transition-colors">Semana</button>
                            <button data-period="month" class="chart-filter-btn px-3 py-1 text-sm font-medium rounded-md transition-colors filter-btn-active">Mês</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="utilizationChart"></canvas>
                    </div>
                </div>
            </div>
            <!-- Conteúdo de Gerenciar Salas -->
            <div id="manage-rooms-view-content" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-slate-800">Gerenciar Salas</h2>
                    <button id="add-room-btn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-all duration-300 shadow hover:shadow-lg">Adicionar Sala</button>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left">
                            <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                                <tr>
                                    <th class="px-6 py-3">Nome da Sala</th>
                                    <th class="px-6 py-3">Capacidade</th>
                                    <th class="px-6 py-3">Status</th>
                                    <th class="px-6 py-3">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="rooms-table-body">
                                <!-- Linhas da tabela serão geradas dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                 </div>
            </div>
        </main>
    </div>

    <!-- Modal de Agendamento -->
    <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 transform transition-all scale-95 opacity-0" id="modalContent">
            <h3 class="text-2xl font-bold text-slate-800 mb-6">Agendar Evento</h3>
            <form>
                <div class="mb-4">
                    <label for="modalTitle" class="block text-sm font-medium text-slate-600">Título do Evento</label>
                    <input type="text" id="modalTitle" class="mt-1 w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm" placeholder="Ex: Alinhamento Semanal">
                </div>
                 <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                         <label for="modalRoom" class="block text-sm font-medium text-slate-600">Sala</label>
                        <select id="modalRoom" class="mt-1 w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm">
                            <option>Sala 1</option>
                            <option>Sala 2</option>
                            <option>Auditório</option>
                        </select>
                    </div>
                     <div>
                        <label for="modalDate" class="block text-sm font-medium text-slate-600">Data e Hora</label>
                        <input type="datetime-local" id="modalDate" class="mt-1 w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm">
                    </div>
                </div>
                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" id="closeModalBtn" class="bg-slate-200 text-slate-800 font-semibold py-2 px-5 rounded-lg hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Confirmar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Gerenciar Sala -->
    <div id="roomModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 transform transition-all scale-95 opacity-0" id="roomModalContent">
            <h3 id="room-modal-title" class="text-2xl font-bold text-slate-800 mb-6">Adicionar Sala</h3>
            <form id="room-form">
                <input type="hidden" id="roomId">
                <div class="mb-4">
                    <label for="roomName" class="block text-sm font-medium text-slate-600">Nome da Sala</label>
                    <input type="text" id="roomName" class="mt-1 w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm" placeholder="Ex: Sala de Reuniões 3" required>
                </div>
                <div class="mb-4">
                    <label for="roomCapacity" class="block text-sm font-medium text-slate-600">Capacidade</label>
                    <input type="number" id="roomCapacity" class="mt-1 w-full px-4 py-2 border border-slate-300 rounded-lg shadow-sm" placeholder="Ex: 8" required>
                </div>
                <div class="flex justify-end space-x-4 mt-8">
                    <button type="button" id="closeRoomModalBtn" class="bg-slate-200 text-slate-800 font-semibold py-2 px-5 rounded-lg hover:bg-slate-300 transition-colors">Cancelar</button>
                    <button type="submit" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">Salvar</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const state = {
                currentView: 'login',
                userSubView: 'calendar',
                adminSubView: 'dashboard',
                selectedYear: new Date().getFullYear(),
                selectedMonth: new Date().getMonth(),
                adminDashboardPeriod: 'month',
                rooms: [
                    { id: 1, name: 'Sala 1', capacity: 10, status: 'active' },
                    { id: 2, name: 'Auditório', capacity: 50, status: 'active' },
                    { id: 3, name: 'Sala 2', capacity: 8, status: 'inactive' },
                ],
                editingRoomId: null,
            };

            const views = {
                login: document.getElementById('loginView'),
                user: document.getElementById('userView'),
                admin: document.getElementById('adminView'),
            };

            const userSubViews = {
                calendar: document.getElementById('calendar-view-content'),
                bookings: document.getElementById('my-bookings-view-content'),
            };
            
            const adminSubViews = {
                dashboard: document.getElementById('dashboard-view-content'),
                rooms: document.getElementById('manage-rooms-view-content'),
            };

            const loginForm = document.getElementById('loginForm');
            const logoutBtns = document.querySelectorAll('.logout-btn');
            const userNameSpan = document.getElementById('userName');
            
            const bookingModal = document.getElementById('bookingModal');
            const modalContent = document.getElementById('modalContent');
            const openModalBtn = document.getElementById('openModalBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');

            const roomModal = document.getElementById('roomModal');
            const roomModalContent = document.getElementById('roomModalContent');
            const closeRoomModalBtn = document.getElementById('closeRoomModalBtn');
            const addRoomBtn = document.getElementById('add-room-btn');
            const roomForm = document.getElementById('room-form');
            const roomsTableBody = document.getElementById('rooms-table-body');
            
            const monthFilter = document.getElementById('month-filter');
            const yearFilter = document.getElementById('year-filter');
            const monthYearDisplay = document.getElementById('month-year-display');
            const calendarGridContainer = document.getElementById('calendar-grid-container');
            const chartFilters = document.getElementById('chart-filters');

            let utilizationChartInstance = null;
            const monthNames = ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

            function initFilters() {
                monthFilter.innerHTML = monthNames.map((name, index) => `<option value="${index}">${name}</option>`).join('');
                const currentYear = new Date().getFullYear();
                let yearOptions = '';
                for (let i = currentYear - 5; i <= currentYear + 5; i++) {
                    yearOptions += `<option value="${i}">${i}</option>`;
                }
                yearFilter.innerHTML = yearOptions;

                monthFilter.value = state.selectedMonth;
                yearFilter.value = state.selectedYear;

                monthFilter.addEventListener('change', (e) => {
                    state.selectedMonth = parseInt(e.target.value);
                    render();
                });
                yearFilter.addEventListener('change', (e) => {
                    state.selectedYear = parseInt(e.target.value);
                    render();
                });
            }
            
            function generateCalendar() {
                const year = state.selectedYear;
                const month = state.selectedMonth;
                monthYearDisplay.textContent = `${monthNames[month]} ${year}`;
                
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const weekDays = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];

                let headerHtml = weekDays.map(day => `<div class="font-bold py-2">${day}</div>`).join('');
                headerHtml = `<div class="font-bold py-2">Horário</div>` + headerHtml;
                
                let bodyHtml = '';
                const hours = Array.from({ length: 9 }, (_, i) => String(8 + i).padStart(2, '0') + ':00');

                hours.forEach(hour => {
                    bodyHtml += `<div class="p-2 border-t font-semibold text-center">${hour}</div>`;
                    for(let i = 0; i < 7; i++) {
                        const isWeekend = i === 0 || i === 6;
                        const isBooked = Math.random() > 0.6;
                        if (isWeekend) {
                            bodyHtml += `<div class="p-3 border rounded-lg bg-slate-100"></div>`;
                        } else if(isBooked) {
                            bodyHtml += `<div class="p-3 border rounded-lg bg-rose-50 text-rose-800 font-medium text-center">Ocupado</div>`;
                        } else {
                            bodyHtml += `<div class="p-3 border rounded-lg bg-emerald-50 text-emerald-800 cursor-pointer hover:bg-emerald-100 hover:shadow-sm transition-all duration-200 open-modal-slot text-center">Livre</div>`;
                        }
                    }
                });

                calendarGridContainer.innerHTML = `
                    <div class="grid calendar-grid gap-2 text-sm min-w-[700px]">
                        ${headerHtml}
                        ${bodyHtml}
                    </div>
                `;
                
                document.querySelectorAll('.open-modal-slot').forEach(slot => slot.addEventListener('click', openBookingModal));
            }

            function renderRoomsTable() {
                roomsTableBody.innerHTML = state.rooms.map(room => `
                    <tr class="bg-white border-b">
                        <td class="px-6 py-4 font-medium">${room.name}</td>
                        <td class="px-6 py-4">${room.capacity} pessoas</td>
                        <td class="px-6 py-4 font-semibold ${room.status === 'active' ? 'text-green-600' : 'text-slate-500'}">
                            ${room.status === 'active' ? 'Ativa' : 'Inativa'}
                        </td>
                        <td class="px-6 py-4 space-x-4">
                            <button data-id="${room.id}" class="edit-room-btn font-medium text-blue-600 hover:underline">Editar</button>
                            <button data-id="${room.id}" class="toggle-status-btn font-medium ${room.status === 'active' ? 'text-red-600' : 'text-green-600'} hover:underline">
                                ${room.status === 'active' ? 'Desativar' : 'Ativar'}
                            </button>
                        </td>
                    </tr>
                `).join('');
                document.getElementById('total-rooms-kpi').textContent = state.rooms.filter(r => r.status === 'active').length;
            }

            function render() {
                Object.values(views).forEach(v => v.classList.add('hidden'));
                
                if (state.currentView === 'login') {
                    views.login.classList.remove('hidden');
                } else if (state.currentView === 'user') {
                    views.user.classList.remove('hidden');
                    Object.values(userSubViews).forEach(v => v.classList.add('hidden'));
                    document.querySelectorAll('#userView .nav-link').forEach(l => l.classList.remove('nav-link-active'));

                    if (state.userSubView === 'calendar') {
                        userSubViews.calendar.classList.remove('hidden');
                        document.getElementById('nav-calendar').classList.add('nav-link-active');
                        generateCalendar();
                    } else if (state.userSubView === 'bookings') {
                        userSubViews.bookings.classList.remove('hidden');
                        document.getElementById('nav-my-bookings').classList.add('nav-link-active');
                    }
                } else if (state.currentView === 'admin') {
                    views.admin.classList.remove('hidden');
                    Object.values(adminSubViews).forEach(v => v.classList.add('hidden'));
                    document.querySelectorAll('#adminView .nav-link').forEach(l => l.classList.remove('nav-link-active'));
                    
                    if (state.adminSubView === 'dashboard') {
                        adminSubViews.dashboard.classList.remove('hidden');
                        document.getElementById('nav-dashboard').classList.add('nav-link-active');
                        renderAdminChart();
                    } else if (state.adminSubView === 'rooms') {
                        adminSubViews.rooms.classList.remove('hidden');
                        document.getElementById('nav-manage-rooms').classList.add('nav-link-active');
                        renderRoomsTable();
                    }
                }
            }
            
            function openBookingModal() {
                bookingModal.classList.remove('hidden');
                setTimeout(() => modalContent.classList.remove('scale-95', 'opacity-0'), 10);
            }
            
            function closeBookingModal() {
                modalContent.classList.add('scale-95', 'opacity-0');
                 setTimeout(() => bookingModal.classList.add('hidden'), 200);
            }
            
            function openRoomModal(roomId = null) {
                state.editingRoomId = roomId;
                const modalTitle = document.getElementById('room-modal-title');
                if (roomId) {
                    const room = state.rooms.find(r => r.id === roomId);
                    modalTitle.textContent = 'Editar Sala';
                    document.getElementById('roomId').value = room.id;
                    document.getElementById('roomName').value = room.name;
                    document.getElementById('roomCapacity').value = room.capacity;
                } else {
                    modalTitle.textContent = 'Adicionar Sala';
                    roomForm.reset();
                }
                roomModal.classList.remove('hidden');
                setTimeout(() => roomModalContent.classList.remove('scale-95', 'opacity-0'), 10);
            }

            function closeRoomModal() {
                roomModalContent.classList.add('scale-95', 'opacity-0');
                setTimeout(() => roomModal.classList.add('hidden'), 200);
            }

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const emailInput = document.getElementById('email');
                if (emailInput.value.toLowerCase().trim() === 'admin@email.com') {
                    state.currentView = 'admin';
                    state.adminSubView = 'dashboard';
                } else if (emailInput.value.trim() !== '') {
                    userNameSpan.textContent = emailInput.value.split('@')[0];
                    state.currentView = 'user';
                    state.userSubView = 'calendar';
                }
                render();
            });

            logoutBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('email').value = '';
                    document.getElementById('password').value = '';
                    state.currentView = 'login';
                    if (utilizationChartInstance) {
                        utilizationChartInstance.destroy();
                        utilizationChartInstance = null;
                    }
                    render();
                });
            });
            
            document.getElementById('nav-calendar').addEventListener('click', (e) => { e.preventDefault(); state.userSubView = 'calendar'; render(); });
            document.getElementById('nav-my-bookings').addEventListener('click', (e) => { e.preventDefault(); state.userSubView = 'bookings'; render(); });
            document.getElementById('nav-dashboard').addEventListener('click', (e) => { e.preventDefault(); state.adminSubView = 'dashboard'; render(); });
            document.getElementById('nav-manage-rooms').addEventListener('click', (e) => { e.preventDefault(); state.adminSubView = 'rooms'; render(); });

            openModalBtn.addEventListener('click', openBookingModal);
            closeModalBtn.addEventListener('click', closeBookingModal);
            bookingModal.addEventListener('click', (e) => { if (e.target === bookingModal) closeBookingModal(); });

            addRoomBtn.addEventListener('click', () => openRoomModal());
            closeRoomModalBtn.addEventListener('click', closeRoomModal);
            roomModal.addEventListener('click', (e) => { if (e.target === roomModal) closeRoomModal(); });

            roomForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('roomName').value;
                const capacity = document.getElementById('roomCapacity').value;
                if(state.editingRoomId) {
                    const room = state.rooms.find(r => r.id === state.editingRoomId);
                    room.name = name;
                    room.capacity = parseInt(capacity);
                } else {
                    const newId = Math.max(...state.rooms.map(r => r.id)) + 1;
                    state.rooms.push({ id: newId, name, capacity: parseInt(capacity), status: 'active'});
                }
                renderRoomsTable();
                closeRoomModal();
            });

            roomsTableBody.addEventListener('click', (e) => {
                const target = e.target;
                const id = parseInt(target.dataset.id);
                if (target.classList.contains('edit-room-btn')) {
                    openRoomModal(id);
                }
                if (target.classList.contains('toggle-status-btn')) {
                    const room = state.rooms.find(r => r.id === id);
                    room.status = room.status === 'active' ? 'inactive' : 'active';
                    renderRoomsTable();
                }
            });

            chartFilters.addEventListener('click', (e) => {
                if(e.target.classList.contains('chart-filter-btn')) {
                    state.adminDashboardPeriod = e.target.dataset.period;
                    document.querySelectorAll('.chart-filter-btn').forEach(btn => btn.classList.remove('filter-btn-active'));
                    e.target.classList.add('filter-btn-active');
                    renderAdminChart();
                }
            });

            const chartData = {
                month: { labels: ['Sala 1', 'Sala 2', 'Auditório'], data: [40, 25, 60] },
                week: { labels: ['Sala 1', 'Sala 2', 'Auditório'], data: [10, 8, 15] },
                day: { labels: ['Sala 1', 'Sala 2', 'Auditório'], data: [2, 1, 3] },
            };

            function renderAdminChart() {
                if(utilizationChartInstance) utilizationChartInstance.destroy();
                const periodData = chartData[state.adminDashboardPeriod];
                const ctx = document.getElementById('utilizationChart').getContext('2d');
                utilizationChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: periodData.labels,
                        datasets: [{
                            label: 'Nº de Agendamentos',
                            data: periodData.data,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderRadius: 6,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                        scales: { x: { beginAtZero: true, grid: { display: false } }, y: { grid: { display: false } } },
                        plugins: { legend: { display: false }, tooltip: { backgroundColor: '#1e293b', titleFont: { size: 14, weight: 'bold' }, bodyFont: { size: 12 }, displayColors: false, padding: 10, cornerRadius: 8 } }
                    }
                });
            }

            initFilters();
            render();
        });
    </script>

</body>
</html>